import fetch from 'node-fetch'

const site_url = "https://ernestsuyver.com"

// full SVGs at <https://napkin.io/examples/site-status-badge>
const customUpBadge = '<svg width="129" height="30" viewBox="0 0 129 30" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="129" height="30" rx="3" fill="#1AA987"/><path d="M61.7033 13.6719C61.6635 13.2997 61.4959 13.0099 61.2005 12.8026C60.9078 12.5952 60.5272 12.4915 60.0584 12.4915C59.7289 12.4915 59.4462 12.5412 59.2104 12.6406C58.9746 12.7401 58.7942 12.875 58.6692 13.0455C58.5442 13.2159 58.4803 13.4105 58.4775 13.6293C58.4775 13.8111 58.5186 13.9687 58.601 14.1023C58.6863 14.2358 58.8013 14.3494 58.9462 14.4432C59.0911 14.5341 59.2516 14.6108 59.4277 14.6733C59.6039 14.7358 59.7814 14.7884 59.9604 14.831L60.7786 15.0355C61.1081 15.1122 61.4249 15.2159 61.7289 15.3466C62.0357 15.4773 62.3098 15.642 62.5513 15.8409C62.7956 16.0398 62.9888 16.2798 63.1309 16.5611C63.2729 16.8423 63.3439 17.1719 63.3439 17.5497C63.3439 18.0611 63.2132 18.5114 62.9519 18.9006C62.6905 19.2869 62.3127 19.5895 61.8184 19.8082C61.3269 20.0241 60.7317 20.1321 60.0328 20.1321C59.3539 20.1321 58.7644 20.027 58.2644 19.8168C57.7672 19.6065 57.378 19.2997 57.0968 18.8963C56.8184 18.4929 56.6678 18.0014 56.6451 17.4219H58.2005C58.2232 17.7259 58.3169 17.9787 58.4817 18.1804C58.6465 18.3821 58.861 18.5327 59.1252 18.6321C59.3922 18.7315 59.6905 18.7812 60.0201 18.7812C60.3638 18.7812 60.665 18.7301 60.9235 18.6278C61.1848 18.5227 61.3894 18.3778 61.5371 18.1932C61.6848 18.0057 61.7601 17.7869 61.763 17.5369C61.7601 17.3097 61.6934 17.1222 61.5627 16.9744C61.432 16.8239 61.2488 16.6989 61.013 16.5994C60.78 16.4972 60.5073 16.4062 60.1948 16.3267L59.2019 16.071C58.4831 15.8864 57.915 15.6065 57.4973 15.2315C57.0826 14.8537 56.8752 14.3523 56.8752 13.7273C56.8752 13.2131 57.0144 12.7628 57.2928 12.3764C57.574 11.9901 57.9561 11.6903 58.4391 11.4773C58.9221 11.2614 59.4689 11.1534 60.0797 11.1534C60.699 11.1534 61.2417 11.2614 61.7076 11.4773C62.1763 11.6903 62.5442 11.9872 62.8113 12.3679C63.0783 12.7457 63.2161 13.1804 63.2246 13.6719H61.7033ZM64.6852 20V13.4545H66.2278V20H64.6852ZM65.4608 12.5256C65.2164 12.5256 65.0062 12.4446 64.8301 12.2827C64.6539 12.1179 64.5659 11.9205 64.5659 11.6903C64.5659 11.4574 64.6539 11.2599 64.8301 11.098C65.0062 10.9332 65.2164 10.8509 65.4608 10.8509C65.7079 10.8509 65.9181 10.9332 66.0914 11.098C66.2676 11.2599 66.3556 11.4574 66.3556 11.6903C66.3556 11.9205 66.2676 12.1179 66.0914 12.2827C65.9181 12.4446 65.7079 12.5256 65.4608 12.5256ZM71.0826 13.4545V14.6477H67.3198V13.4545H71.0826ZM68.2488 11.8864H69.7914V18.0312C69.7914 18.2386 69.8226 18.3977 69.8851 18.5085C69.9505 18.6165 70.0357 18.6903 70.1408 18.7301C70.2459 18.7699 70.3624 18.7898 70.4902 18.7898C70.5868 18.7898 70.6749 18.7827 70.7544 18.7685C70.8368 18.7543 70.8993 18.7415 70.9419 18.7301L71.2019 19.9361C71.1195 19.9645 71.0016 19.9957 70.8482 20.0298C70.6976 20.0639 70.513 20.0838 70.2942 20.0895C69.9078 20.1009 69.5598 20.0426 69.2502 19.9148C68.9405 19.7841 68.6948 19.5824 68.513 19.3097C68.334 19.0369 68.2459 18.696 68.2488 18.2869V11.8864ZM75.2001 20.1278C74.5439 20.1278 73.9771 19.9915 73.4998 19.7188C73.0254 19.4432 72.6603 19.054 72.4047 18.5511C72.149 18.0455 72.0211 17.4503 72.0211 16.7656C72.0211 16.0923 72.149 15.5014 72.4047 14.9929C72.6632 14.4815 73.024 14.0838 73.487 13.7997C73.9501 13.5128 74.4941 13.3693 75.1191 13.3693C75.5225 13.3693 75.9032 13.4347 76.2612 13.5653C76.622 13.6932 76.9402 13.892 77.2157 14.1619C77.4941 14.4318 77.7129 14.7756 77.872 15.1932C78.0311 15.608 78.1106 16.1023 78.1106 16.6761V17.1491H72.7456V16.1094H76.6319C76.6291 15.8139 76.5652 15.5511 76.4402 15.321C76.3152 15.0881 76.1404 14.9048 75.916 14.7713C75.6944 14.6378 75.4359 14.571 75.1404 14.571C74.8251 14.571 74.5481 14.6477 74.3095 14.8011C74.0708 14.9517 73.8848 15.1506 73.7512 15.3977C73.6206 15.642 73.5538 15.9105 73.551 16.2031V17.1108C73.551 17.4915 73.6206 17.8182 73.7598 18.0909C73.899 18.3608 74.0936 18.5682 74.3436 18.7131C74.5936 18.8551 74.8862 18.9261 75.2214 18.9261C75.4458 18.9261 75.649 18.8949 75.8308 18.8324C76.0126 18.767 76.1703 18.6719 76.3038 18.5469C76.4373 18.4219 76.5382 18.267 76.6064 18.0824L78.0467 18.2443C77.9558 18.625 77.7825 18.9574 77.5268 19.2415C77.274 19.5227 76.9501 19.7415 76.5552 19.8977C76.1603 20.0511 75.7086 20.1278 75.2001 20.1278ZM87.9618 11.2727H89.5428V16.9744C89.5428 17.5994 89.3951 18.1491 89.0996 18.6236C88.807 19.098 88.3951 19.4687 87.8638 19.7358C87.3326 20 86.7118 20.1321 86.0016 20.1321C85.2885 20.1321 84.6664 20 84.1351 19.7358C83.6039 19.4687 83.1919 19.098 82.8993 18.6236C82.6067 18.1491 82.4604 17.5994 82.4604 16.9744V11.2727H84.0414V16.8423C84.0414 17.206 84.1209 17.5298 84.28 17.8139C84.4419 18.098 84.6692 18.321 84.9618 18.483C85.2544 18.642 85.601 18.7216 86.0016 18.7216C86.4022 18.7216 86.7488 18.642 87.0414 18.483C87.3368 18.321 87.5641 18.098 87.7232 17.8139C87.8823 17.5298 87.9618 17.206 87.9618 16.8423V11.2727ZM91.193 22.4545V13.4545H92.71V14.5369H92.7995C92.8791 14.3778 92.9913 14.2088 93.1362 14.0298C93.2811 13.848 93.4771 13.6932 93.7243 13.5653C93.9714 13.4347 94.2868 13.3693 94.6703 13.3693C95.176 13.3693 95.6319 13.4986 96.0382 13.7571C96.4473 14.0128 96.7711 14.392 97.0098 14.8949C97.2512 15.3949 97.372 16.0085 97.372 16.7358C97.372 17.4545 97.2541 18.0653 97.0183 18.5682C96.7825 19.071 96.4615 19.4545 96.0552 19.7188C95.649 19.983 95.1887 20.1151 94.6745 20.1151C94.2995 20.1151 93.9885 20.0526 93.7413 19.9276C93.4941 19.8026 93.2953 19.652 93.1447 19.4759C92.997 19.2969 92.8819 19.1278 92.7995 18.9688H92.7356V22.4545H91.193ZM92.7058 16.7273C92.7058 17.1506 92.7654 17.5213 92.8848 17.8395C93.0069 18.1577 93.1816 18.4062 93.4089 18.5852C93.639 18.7614 93.9174 18.8494 94.2441 18.8494C94.585 18.8494 94.8706 18.7585 95.1007 18.5767C95.3308 18.392 95.5041 18.1406 95.6206 17.8224C95.7399 17.5014 95.7995 17.1364 95.7995 16.7273C95.7995 16.321 95.7413 15.9602 95.6248 15.6449C95.5083 15.3295 95.335 15.0824 95.1049 14.9034C94.8748 14.7244 94.5879 14.6349 94.2441 14.6349C93.9146 14.6349 93.6348 14.7216 93.4047 14.8949C93.1745 15.0682 92.9998 15.3111 92.8805 15.6236C92.764 15.9361 92.7058 16.304 92.7058 16.7273Z" fill="white"/><path d="M0 3C0 1.34315 1.34315 0 3 0H32V30H3C1.34315 30 0 28.6569 0 27V3Z" fill="#1DBA94"/><path d="M16 21.75C19.7279 21.75 22.75 18.7279 22.75 15C22.75 11.2721 19.7279 8.25 16 8.25C12.2721 8.25 9.25 11.2721 9.25 15C9.25 18.7279 12.2721 21.75 16 21.75Z" stroke="white" stroke-width="1.125" stroke-linecap="round" stroke-linejoin="round"/><path d="M13.4688 14.4375C13.9347 14.4375 14.3125 14.0597 14.3125 13.5938C14.3125 13.1278 13.9347 12.75 13.4688 12.75C13.0028 12.75 12.625 13.1278 12.625 13.5938C12.625 14.0597 13.0028 14.4375 13.4688 14.4375Z" fill="white"/><path d="M18.5312 14.4375C18.9972 14.4375 19.375 14.0597 19.375 13.5938C19.375 13.1278 18.9972 12.75 18.5312 12.75C18.0653 12.75 17.6875 13.1278 17.6875 13.5938C17.6875 14.0597 18.0653 14.4375 18.5312 14.4375Z" fill="white"/><path d="M18.925 16.6875C18.6276 17.1998 18.2009 17.625 17.6876 17.9206C17.1742 18.2162 16.5923 18.3717 16 18.3717C15.4076 18.3717 14.8257 18.2162 14.3123 17.9206C13.799 17.625 13.3723 17.1998 13.075 16.6875" stroke="white" stroke-width="1.125" stroke-linecap="round" stroke-linejoin="round"/></svg>'

const customDownBadge = '<svg width="129" height="30" viewBox="0 0 129 30" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="129" height="30" rx="3" fill="#FF6D4C"/><path d="M53.7717 13.6719C53.7319 13.2997 53.5643 13.0099 53.2688 12.8026C52.9762 12.5952 52.5955 12.4915 52.1268 12.4915C51.7972 12.4915 51.5146 12.5412 51.2788 12.6406C51.043 12.7401 50.8626 12.875 50.7376 13.0455C50.6126 13.2159 50.5487 13.4105 50.5458 13.6293C50.5458 13.8111 50.587 13.9687 50.6694 14.1023C50.7546 14.2358 50.8697 14.3494 51.0146 14.4432C51.1594 14.5341 51.32 14.6108 51.4961 14.6733C51.6722 14.7358 51.8498 14.7884 52.0288 14.831L52.8469 15.0355C53.1765 15.1122 53.4933 15.2159 53.7972 15.3466C54.104 15.4773 54.3782 15.642 54.6197 15.8409C54.864 16.0398 55.0572 16.2798 55.1992 16.5611C55.3413 16.8423 55.4123 17.1719 55.4123 17.5497C55.4123 18.0611 55.2816 18.5114 55.0202 18.9006C54.7589 19.2869 54.381 19.5895 53.8867 19.8082C53.3952 20.0241 52.8001 20.1321 52.1012 20.1321C51.4222 20.1321 50.8327 20.027 50.3327 19.8168C49.8356 19.6065 49.4464 19.2997 49.1651 18.8963C48.8867 18.4929 48.7362 18.0014 48.7134 17.4219H50.2688C50.2915 17.7259 50.3853 17.9787 50.5501 18.1804C50.7148 18.3821 50.9293 18.5327 51.1935 18.6321C51.4606 18.7315 51.7589 18.7812 52.0884 18.7812C52.4322 18.7812 52.7333 18.7301 52.9918 18.6278C53.2532 18.5227 53.4577 18.3778 53.6055 18.1932C53.7532 18.0057 53.8285 17.7869 53.8313 17.5369C53.8285 17.3097 53.7617 17.1222 53.631 16.9744C53.5004 16.8239 53.3171 16.6989 53.0813 16.5994C52.8484 16.4972 52.5756 16.4062 52.2631 16.3267L51.2702 16.071C50.5515 15.8864 49.9833 15.6065 49.5657 15.2315C49.1509 14.8537 48.9435 14.3523 48.9435 13.7273C48.9435 13.2131 49.0827 12.7628 49.3612 12.3764C49.6424 11.9901 50.0245 11.6903 50.5075 11.4773C50.9904 11.2614 51.5373 11.1534 52.1481 11.1534C52.7674 11.1534 53.31 11.2614 53.7759 11.4773C54.2447 11.6903 54.6126 11.9872 54.8796 12.3679C55.1467 12.7457 55.2844 13.1804 55.293 13.6719H53.7717ZM56.7536 20V13.4545H58.2962V20H56.7536ZM57.5291 12.5256C57.2848 12.5256 57.0746 12.4446 56.8984 12.2827C56.7223 12.1179 56.6342 11.9205 56.6342 11.6903C56.6342 11.4574 56.7223 11.2599 56.8984 11.098C57.0746 10.9332 57.2848 10.8509 57.5291 10.8509C57.7763 10.8509 57.9865 10.9332 58.1598 11.098C58.3359 11.2599 58.424 11.4574 58.424 11.6903C58.424 11.9205 58.3359 12.1179 58.1598 12.2827C57.9865 12.4446 57.7763 12.5256 57.5291 12.5256ZM63.1509 13.4545V14.6477H59.3881V13.4545H63.1509ZM60.3171 11.8864H61.8597V18.0312C61.8597 18.2386 61.891 18.3977 61.9535 18.5085C62.0188 18.6165 62.104 18.6903 62.2092 18.7301C62.3143 18.7699 62.4308 18.7898 62.5586 18.7898C62.6552 18.7898 62.7433 18.7827 62.8228 18.7685C62.9052 18.7543 62.9677 18.7415 63.0103 18.7301L63.2702 19.9361C63.1879 19.9645 63.07 19.9957 62.9165 20.0298C62.766 20.0639 62.5813 20.0838 62.3626 20.0895C61.9762 20.1009 61.6282 20.0426 61.3185 19.9148C61.0089 19.7841 60.7631 19.5824 60.5813 19.3097C60.4023 19.0369 60.3143 18.696 60.3171 18.2869V11.8864ZM67.2685 20.1278C66.6122 20.1278 66.0455 19.9915 65.5682 19.7188C65.0938 19.4432 64.7287 19.054 64.473 18.5511C64.2173 18.0455 64.0895 17.4503 64.0895 16.7656C64.0895 16.0923 64.2173 15.5014 64.473 14.9929C64.7315 14.4815 65.0923 14.0838 65.5554 13.7997C66.0185 13.5128 66.5625 13.3693 67.1875 13.3693C67.5909 13.3693 67.9716 13.4347 68.3295 13.5653C68.6903 13.6932 69.0085 13.892 69.2841 14.1619C69.5625 14.4318 69.7813 14.7756 69.9403 15.1932C70.0994 15.608 70.179 16.1023 70.179 16.6761V17.1491H64.8139V16.1094H68.7003C68.6974 15.8139 68.6335 15.5511 68.5085 15.321C68.3835 15.0881 68.2088 14.9048 67.9844 14.7713C67.7628 14.6378 67.5043 14.571 67.2088 14.571C66.8935 14.571 66.6165 14.6477 66.3778 14.8011C66.1392 14.9517 65.9531 15.1506 65.8196 15.3977C65.6889 15.642 65.6222 15.9105 65.6193 16.2031V17.1108C65.6193 17.4915 65.6889 17.8182 65.8281 18.0909C65.9673 18.3608 66.1619 18.5682 66.4119 18.7131C66.6619 18.8551 66.9545 18.9261 67.2898 18.9261C67.5142 18.9261 67.7173 18.8949 67.8991 18.8324C68.081 18.767 68.2386 18.6719 68.3722 18.5469C68.5057 18.4219 68.6065 18.267 68.6747 18.0824L70.1151 18.2443C70.0241 18.625 69.8509 18.9574 69.5952 19.2415C69.3423 19.5227 69.0185 19.7415 68.6236 19.8977C68.2287 20.0511 67.777 20.1278 67.2685 20.1278ZM77.4862 20H74.5288V11.2727H77.5458C78.4123 11.2727 79.1566 11.4474 79.7788 11.7969C80.4038 12.1435 80.8839 12.642 81.2191 13.2926C81.5543 13.9432 81.7219 14.7216 81.7219 15.6278C81.7219 16.5369 81.5529 17.3182 81.2148 17.9716C80.8796 18.625 80.3952 19.1264 79.7617 19.4759C79.131 19.8253 78.3725 20 77.4862 20ZM76.1097 18.6321H77.4094C78.0174 18.6321 78.5245 18.5213 78.9308 18.2997C79.337 18.0753 79.6424 17.7415 79.8469 17.2983C80.0515 16.8523 80.1538 16.2955 80.1538 15.6278C80.1538 14.9602 80.0515 14.4062 79.8469 13.9659C79.6424 13.5227 79.3398 13.1918 78.9393 12.973C78.5415 12.7514 78.0472 12.6406 77.4563 12.6406H76.1097V18.6321ZM86.011 20.1278C85.3718 20.1278 84.8178 19.9872 84.3491 19.706C83.8803 19.4247 83.5167 19.0312 83.2582 18.5256C83.0025 18.0199 82.8746 17.429 82.8746 16.7528C82.8746 16.0767 83.0025 15.4844 83.2582 14.9759C83.5167 14.4673 83.8803 14.0724 84.3491 13.7912C84.8178 13.5099 85.3718 13.3693 86.011 13.3693C86.6502 13.3693 87.2042 13.5099 87.6729 13.7912C88.1417 14.0724 88.5039 14.4673 88.7596 14.9759C89.0181 15.4844 89.1474 16.0767 89.1474 16.7528C89.1474 17.429 89.0181 18.0199 88.7596 18.5256C88.5039 19.0312 88.1417 19.4247 87.6729 19.706C87.2042 19.9872 86.6502 20.1278 86.011 20.1278ZM86.0195 18.892C86.3661 18.892 86.6559 18.7969 86.8888 18.6065C87.1218 18.4134 87.2951 18.1548 87.4087 17.831C87.5252 17.5071 87.5835 17.1463 87.5835 16.7486C87.5835 16.348 87.5252 15.9858 87.4087 15.6619C87.2951 15.3352 87.1218 15.0753 86.8888 14.8821C86.6559 14.6889 86.3661 14.5923 86.0195 14.5923C85.6644 14.5923 85.369 14.6889 85.1332 14.8821C84.9002 15.0753 84.7255 15.3352 84.609 15.6619C84.4954 15.9858 84.4386 16.348 84.4386 16.7486C84.4386 17.1463 84.4954 17.5071 84.609 17.831C84.7255 18.1548 84.9002 18.4134 85.1332 18.6065C85.369 18.7969 85.6644 18.892 86.0195 18.892ZM91.62 20L89.7706 13.4545H91.343L92.4936 18.0568H92.5533L93.7294 13.4545H95.2848L96.4609 18.0312H96.5249L97.6584 13.4545H99.2351L97.3814 20H95.7749L94.5476 15.5767H94.4581L93.2308 20H91.62ZM101.855 16.1648V20H100.312V13.4545H101.787V14.5668H101.863C102.014 14.2003 102.254 13.9091 102.583 13.6932C102.916 13.4773 103.326 13.3693 103.815 13.3693C104.267 13.3693 104.66 13.4659 104.995 13.6591C105.333 13.8523 105.595 14.1321 105.779 14.4986C105.967 14.8651 106.059 15.3097 106.056 15.8324V20H104.514V16.071C104.514 15.6335 104.4 15.2912 104.173 15.044C103.949 14.7969 103.637 14.6733 103.24 14.6733C102.97 14.6733 102.73 14.733 102.52 14.8523C102.312 14.9687 102.149 15.1378 102.029 15.3594C101.913 15.581 101.855 15.8494 101.855 16.1648Z" fill="white"/><path d="M0 3C0 1.34315 1.34315 0 3 0H32V30H3C1.34315 30 0 28.6569 0 27V3Z" fill="#FE8065"/><path d="M16 20.75C19.7279 20.75 22.75 17.7279 22.75 14C22.75 10.2721 19.7279 7.25 16 7.25C12.2721 7.25 9.25 10.2721 9.25 14C9.25 17.7279 12.2721 20.75 16 20.75Z" stroke="white" stroke-miterlimit="10"/><path d="M19.9375 11.75L17.6875 14" stroke="white" stroke-linecap="round" stroke-linejoin="round"/><path d="M19.9375 14L17.6875 11.75" stroke="white" stroke-linecap="round" stroke-linejoin="round"/><path d="M14.3125 11.75L12.0625 14" stroke="white" stroke-linecap="round" stroke-linejoin="round"/><path d="M14.3125 14L12.0625 11.75" stroke="white" stroke-linecap="round" stroke-linejoin="round"/><path d="M16 18.5C16.466 18.5 16.8438 18.1222 16.8438 17.6562C16.8438 17.1903 16.466 16.8125 16 16.8125C15.534 16.8125 15.1562 17.1903 15.1562 17.6562C15.1562 18.1222 15.534 18.5 16 18.5Z" fill="white"/></svg>'

const isSiteUp = async () => {
  const res = await fetch(site_url)
  return res.ok
}

export default async (req, res) => {
  const forceFail = req.path?.endsWith('/400')

  const healthy = await isSiteUp()
  res.set('content-type', 'image/svg+xml')
  if (healthy && !forceFail) {
    res.send(Buffer.from(customUpBadge).toString('base64'))
  } else {
    res.send(Buffer.from(customDownBadge).toString('base64'))
  }
}
